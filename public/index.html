<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<script src="jquery-2.1.3.min.js"></script>
<head>
    <title>Chatterchat</title>
</head>
<body>
    <textarea id="chat_verlauf"  cols="50" rows="30" disabled></textarea>
    </br>
    Username: <input cols="100" id="username">
    <br>
    <input cols="50" id="message_box">
    <input type="button" value="submit" id="message_send">


<script type="application/javascript">



    function scrollpage() {
        var textarea = document.getElementById('chat_verlauf');
        textarea.scrollTop = textarea.scrollHeight;
    }

    function checkUsername() {
        if($('#username').val().length > 2 && ('#username').val().length < 12)
        {
            return true;
        }
        else {alert("Invalid Username!");};
    };


$(function(){


    $.get("/joined","Anonymous", function(result){
        updatemessage(result);
    });

    $("#message_send").click(function(e) {
        console.log('message sent.');
        sendmessage();

    });

    $("#message_box").keypress(function( event ) {
        if ( event.which == 13 ) {
            console.log("Message sent through ENTER");
            sendmessage();
        }
    });
});

    var sendmessage = function () {
        if(checkUsername() = true ){
            $.get("/message",{"message":$('#message_box').val() , "username":$('#username').val() }, function(result){
                updatemessage(result);
            });
        }

    };

    var updatemessage = function(result){
        $('#message_box').val('');
        $('#chat_verlauf').val('');
        for (var i = 0, length=result.length; i<length; i++ ){
            var msg= result[i].message + "\r";
            // console.log(msg);
            $('#chat_verlauf').val($('#chat_verlauf').val()+  msg);
        }
        scrollpage();

    };

</script>
</body>
</html>