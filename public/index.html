<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<script src="jquery-2.1.3.min.js"></script>
<head>
    <title>Chatterchat</title>
</head>
<body>
    <textarea id="chat_verlauf"  cols="50" rows="30" disabled></textarea>
    </br>
    <input name="message" cols="50" id="message_box">
    <input type="button" value="submit" id="message_send">


<script type="application/javascript">
$(function(){


    $.get("/joined","Anonymous", function(result){
        updatemessage(result);
    });

    $("#message_send").click(function(e) {
        console.log('message sent.');
        sendmessage();

    });

    $("#message_box").keypress(function( event ) {
        if ( event.which == 13 ) {
            console.log("Message sent throught ENTER");
            sendmessage();
        }
    });
});

    var sendmessage = function () {
        $.get("/message",{"message":$('#message_box').val() }, function(result){
            updatemessage(result);
        });

    };

    var updatemessage = function(result){
        $('#message_box').val('');
        for (var i = 0, length=result.length; i<length; i++ ){
            var message= result[i].message + "\r";
            console.log(message);
            $('#chat_verlauf').val($('#chat_verlauf').val()+message);
        }
    };

</script>
</body>
</html>